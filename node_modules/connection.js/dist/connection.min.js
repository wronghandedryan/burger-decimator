!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Connection=b()}(this,function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;return a={bindAll:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=0,d=b.length;d>c;c++)this.bind(a,b[c])},bind:function(a,b){var c=a[b];return a[b]=function(){return c.apply(a,arguments)}}},b=function(a,b){var c;c=b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,arguments)};for(var d in a)c[d]=a[d];var e=function(){this.constructor=c};e.prototype=a.prototype,c.prototype=new e;for(var f in b)c.prototype[f]=b[f];return c},c=function(a){return a===Object(a)},d=function(a){return"[object Array]"===Object.prototype.toString.call(a)},e=function(a,b){var c=function(d,e){for(var f in e){var g=d[f]||{},h=e[f],i=b(h),j=a(h);i||j?(i&&!b(g)&&(d[f]={}),j&&!a(g)&&(d[f]=[]),d[f]=c(g,h)):d[f]=h}return d};return c}(d,c),f=function(a,b){return{isObject:a,deepMerge:b}}(c,e),g=function(a){var b=function(a){this.seperator=a||"."};return b.prototype.get=function(a,b){return this._get(a,b).val},b.prototype.set=function(b,c,d,e){var f=this._get(b,c,!0),g=f.val,h=f.parent,i=f.key,j=a.isObject(g)&&e;return h[i]=j?a.deepMerge(g,d):d,h[i]},b.prototype.remove=function(a,b){var c=this._get(a,b),d=c.parent,e=c.key;delete d[e]},b.prototype._get=function(a,b,c){for(var d=b.split(this.seperator),e=0,f=d.length;f>e;e++){var g=d[e],h=a[g],i=f===e+1,j=!h&&!c;if(i||j)return{key:g,val:h,parent:a};a=a[g]=h||{}}},b}(f),h=function(){var a=this,b=function(){this.events={}};return b.prototype.on=function(b,c,d){return(this.events[b]=this.events[b]||[]).unshift({fn:c,context:d||a}),this},b.prototype.off=function(a,b){var c=this.events[a]||[],d=c.length;if(a)if(b)for(;d--;)c[d].fn===b&&c.splice(d,1);else delete this.events[a];else this.events={};return this},b.prototype.trigger=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=this.events[a]||[],d=c.length,e=[],f=0;d>f;f++)e.push(c[f]);for(;d--;)e[d].fn.apply(e[d].context,b);return this},b}(),i=function(a){return a[0].toUpperCase()+a.slice(1)},j=function(a){return"undefined"==typeof a},k=function(a){return function(b){if(a(b))return 0===b.length;for(var c in b)if(b.hasOwnProperty(c))return!1;return!0}}(d),l=function(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])a[c]=arguments[b][c];return a},m=function(a){var d=b,e=g,f=h,m=i,n=j,o=c,p=k,q=l,r=new e(":");return d(f,{constructor:function(){f.prototype.constructor.apply(this,arguments),this.attributes={},arguments[0]&&this.set.apply(this,arguments)},set:function(a,b,c){var d=o(a);if(d&&(c=b,b=null),c=c||{},d?this._setProperties(a,c):this._setProperty(a,b,c),!c.silent&&!p(this.changed)){for(var e in this.changed)this.triggerMethod("change:"+e,this,this.changed[e],c);this.triggerMethod("change",this,c)}return this},_setProperties:function(a,b){var c={};for(var d in a)this._setProperty(d,a[d],b),q(c,this.changed);this.changed=c},_setProperty:function(a,b,c){this.changed={};var d=r._get(this.attributes,a,!0),e=a.split(":")[0];d.val!==b&&(r.set(d.parent,d.key,b,!c.flat),this.changed[e]=this.attributes[e])},unset:function(a,b){return b=b||{},this._unsetProperty(a),b.silent||p(this.changed)||this.triggerMethod("change",this,b),this},_unsetProperty:function(a){this.changed={};var b=a.split(":"),c=b[0],d=r._get(this.attributes,a,!0);n(d.val)||(r.remove(d.parent,d.key),b[1]?this.changed[c]=this.attributes[c]:this.changed[0]=a)},get:function(a){return a?this._getProperty(a):this.attributes},_getProperty:function(a){return r.get(this.attributes,a)},triggerMethod:function(a){var b=this[this.triggerMethodName(a)];b&&b.apply(this,Array.prototype.slice.call(arguments,1)),this.trigger.apply(this,arguments)},triggerMethodName:function(a){for(var b=a.split(":"),c=0,d=b.length;d>c;c++)b[c]=m(b[c]);return"on"+b.join("")}})}({}),n=function(c){var d=a,e=b,f=m,g=l;return e(f,{defaults:{ping:!0,url:"https://www.google.com/favicon.ico",interval:1e4,timeout:5e3},constructor:function(a){f.prototype.constructor.apply(this,arguments),d.bindAll(this,"_startHeartbeat","_stopHeartbeat","_onOnline","_onOffline","_onHeartbeatError","_onHeartbeatSuccess","_onChangeStatus"),this.attributes.status=0,this.settings=g(this.defaults,a||{}),setTimeout(this[navigator.onLine?"_onOnline":"_onOffline"],0),window.addEventListener("online",this._onOnline),window.addEventListener("offline",this._onOffline)},onChangeStatus:function(a,b){0!==b&&this.triggerMethod(1===b?"online":"offline")},_startHeartbeat:function(){var a="?nocahce="+Math.floor(1e6*Math.random());this.img=new Image,this.img.onerror=this.img.onabort=this._onHeartbeatError,this.img.onload=this._onHeartbeatSuccess,this.img.src=this.settings.url+a,this.timeout=setTimeout(this._onHeartbeatError,this.settings.timeout)},_stopHeartbeat:function(){window.clearTimeout(this.heartbeat),window.clearTimeout(this.timeout),this.img&&(this.img.onload=this.img.onabort=this.img.onerror=function(){},this.img=null)},_onOnline:function(a){return this.settings.ping?this._startHeartbeat():this.set("status",1)},_onOffline:function(a){this._stopHeartbeat(),this.set("status",-1)},_onHeartbeatSuccess:function(){this._stopHeartbeat(),this.heartbeat=setTimeout(this._startHeartbeat,this.settings.interval),this.set("status",1)},_onHeartbeatError:function(){this._stopHeartbeat(),this._startHeartbeat(),this.set("status",-1)}})}({})});